株価変動要因情報を手がかりとする株価変動記事生成へのLLM の適用

西田隼輔 宇津呂武仁



筑波大学大学院 システム情報工学研究群



s2320778 @ u.tsukuba.ac.jp utsuro @ iit.tsukuba.ac.jp



概要

株価変動に関する記事は、変動の要因を分析する点で有用であるが、人手で作成するには手間と時間がかかるため、十分な量が存在していない。
本研究では、大規模言語モデル(LLM)を用いて記事を自動生成する手法を提案する。
日々の株価変動率ランキングに基づく日本語データセット “JFinSR” を構築し、記事と株価変動要因に関する情報を収集した。
このデータセットを用いた few-shot 学習により、株価変動要因から高品質な記事を生成する手法を実現し，zero-shot より優れた性能を達成した。


1 はじめに

株価の変動に関する情報を提供するニュース記事は、単に株価の変動幅を示すだけでなく、価格変動を引き起こした要因についての分析も提供するという点で有用である。
通常このような記事は、人手で書かれることが一般的であるが、現時点で十分な量の記事が存在しているとは言えない。
そこで、本研究では、自然言語処理の分野で高い性能を発揮している大規模言語モデル（LLM）を用いることで、大量の記事を自動で生成することを目的とする。
本研究の目的の概要を、図 1 に示す。
記事生成モデルは記者と同様に、変動の要因となったと考えられる情報を探し、それを基に記事を書く必要がある。
そのような情報は、企業のプレスリリースや決算報告書など、様々な形式で公開されるため、単にそれらを入力として記事を生成しても、高品質な記事を生成できるとは限らない。
以上を踏まえ、記事生成の第一段階として、1 日の株価変動率ランキングを用いた金融記事生成のための日本語データセット “JFinSR” を構築する。
JFinSRは、株価変動率上位 50 銘柄のランキングおよび記事と、株価変動要因に関する情報とで構成される。
続いて “JFinSR” を用いて、LLM の few-shot 学習を行い、株価上昇・下落要因から高品質な記事を自動生成する手法を実現した。
zero-shot と few-shot 学習でそれぞれ生成された記事を比較し、few-shot 学習で生成された記事が、ROUGE-1 および ROUGE-L の評価指標において、より高いスコアを達成したことが示された。



2 関連研究

ニュース記事と株価に関連して、以下の研究が先行して行われている。
Utsuro, Nishida (2024)[10]は、株価変動の特徴を正確に表す株分野の専門用語を選択する手法を提案し、数日間の株価の終値を LLM，株価変動のチャート画像を LMM に入力することで評価を行った。
Nishida ら(2023)[7]は、株価変動記事の本文から見出しを生成するタスクについて、銘柄名の抽出、株価が上昇しているか下落しているかの判定、見出し生成の 3 つの個別のサブタスクとして行う手法を提案した。
Tsutsumi, Utsuro (2022)[9]は、機械読解モデルによって、株価変動記事から株価上昇・下落の原因を抽出する問題を研究した。
また、ニュース記事を利用した株価の予測に関しては、以下のような研究が行われている。
Kalyani ら(2016)[4]は、ニュース記事を用いて株価の動向を予測する手法を提案した。
Kalshani ら(2020)[3]は、ニュース記事の見出しとテクニカル指標を組み合わせることで、株価を予測した。
Chen (2021)[1]は、株価に影響を与える出来事が起こった後の短期間の株価変動について、そのニュース記事の見出しのみを用いて予測する研究を行った。
さらに、Gong ら(2021)[2], Liu ら(2018)[6]は、金融ニュースを使った株価の予測について、サポートベクターマシン(SVM)や長期短期記憶(LSTM)などの異なる機械学習や深層学習の手法を評価した。
図 1 株価変動記事生成の目的

3 データの収集源

1 日の株価変動率ランキングを用いた金融記事生成のための日本語データセット “JFinSR” を構築するために、主に金融関連のニュース記事や情報を配信する Web メディアである「株探」1）と「日本経済新聞」2）を利用した。



3.1 株価変動記事

主に株価変動記事の収集源として利用した「本日のランキング」は，1 日の株価の値上がり率、値下がり率各上位 50 銘柄について、ランキング形式で情報を提供している「株探」の web ページである。
「本日のランキング」には、各銘柄について、以下の 5 つの項目の情報が掲載されている：銘柄名、市場名、上昇率/下落率(%)、株価、個別ニュース／決算速報／テーマ。
このうち、「個別ニュース／決算速報／テーマ」の項目については、株価変動の要因に関する記事のリンクが掲載されている場合と、その銘柄がどの業種に属するかのみが書かれ、記事のリンクが無い場合、空欄の場合がある。
JFinSR では，9 月 2 日〜11 月 6 日のうち 12 日間の「本日のランキング」を利用した。
すなわち、1,200 例(= 50 ×2（上昇・下落）× 12 日間)を収集した。



3.2 株価変動要因情報

株価変動要因情報の収集源として利用した「企業発情報」は，「日本経済新聞」が上場企業の様々な情報を集約して公開している Web ページである。
企1） https://kabutan.jp/2） https://www.nikkei.com/業発情報は、日本の各市場に上場する企業約 4000社が、上場先取引所のホームページを通じて一般に開示した情報を、ほぼリアルタイムで自動的に掲載している。
JFinSR では、3.1 節で収集したランキングに掲載されている計 1,200 の銘柄について、ランキング掲載日より前の最新の日付の記事をそれぞれ取得した。
なお、情報は閲覧日から最大１年分遡って参照することができ、1,200 件すべての事例について情報が存在した。



4 データ分析

JFinSR を記事の自動生成のために用いるにあたり、必要となる各種分析を行った。


4.1 株価変動記事と株価変動要因情報の



対応関係

JFinSR に含まれる 1,200 件の事例のうち、株探変動記事(以下、記事)が存在したものは 287 件であった。
この 287 件について、記事で説明されている株価変動の要因が、株価変動要因情報(以下、要因情報)に含まれているかどうかを検証した。
また、それらを要因情報の開示日が記事掲載日の何日前であるかによって分類して調べた。
検証および分類の結果を表 1 に示す。
要因情報と異なる内容の記事が掲載されている事例は、合計 68 件あった。
そのような事例の記事で説明されている変動要因のほとんどが、証券会社のレーティングなど他者からの評価によるものであり、変動要因として適切であるものの、各企業から公開される情報としては収集することが困難な情報であった。
表 1 「株価変動要因情報(要因情報)」の配信日から経過した日数ごとの「株価変動記事(記事)」の数要因情報の最新配信日から記事と要因情報の関係記事が書かれるまでの日数合計同日 1 日前 2 日以上前要因情報と同じ内容について書かれた記事が存在する 112 75 32 219要因情報と異なる内容について書かれた記事が存在する 5 11 52 68合計 117 86 84 287表 2 「株価変動要因情報(要因情報)」の形式とカテゴリー要因情報のカテゴリー要因情報の形式株・業績に直接新製品の発売・他社との提携合計関わる情報サービスの開始等図表を含む 104 7 3 114図表を含まない 10 50 45 105合計 114 57 48 219

4.2 株価変動記事の内容と形式

前節で行った検証の結果にしたがい、要因情報と同じ内容について書かれた記事が存在する事例に絞って、要因情報の内容と形式に関する分析を行った。
そのような事例計 219 件について、要因情報の内容によって以下の 3 つのカテゴリーに分類した:株・業績に直接関わる情報、新製品の発表・サービスの開始等、他社との提携。
また、要因情報の形式によって以下の 2 つのカテゴリーに分類した: テキストと図表を含む PDF ファイル、テキストと図表を含まない PDF ファイル。
分析の結果を表 2 に示す。
結果から、様々な形式と内容の組み合わせの事例がまんべんなく分布していることが明らかになった。
また、本研究の対象とするテキスト情報のみからなる要因情報を含む事例は、合計で 105 件あり、分析の対象とした事例 219 件の半分程度を占めていた。



5 株価変動要因情報からの記事の



生成



5.1 実験手順

この節では、JFinSR を用いた記事生成の具体的な手順について述べる。
JFinSR から、要因情報と同じ内容について書かれた記事が存在し、要因情報に図表を含まない 105 件(上昇 83 件、下落 22 件)の事例を実験用事例として用いた。
105 件の実験用事例を，100 件の評価用事例と、5 件の few-shot 学習用事例の 2 つのサブセットに分割した。
評価用データの各事例について、銘柄名、ランキング掲載日までの３日間の株価の終値と、記事に対応する要因情報を記事生成モデルに入力した。
モデルとしては、最先端の LLM の 1 つである GPT-4o [8]を用いた。
記事を生成させる上で、以下の 2 種類のプロンプトを用意した。
1 つは、1 回の命令のみで記事を生成するプロンプトで、これを baseline のプロンプトと呼ぶ。
baseline のプロンプトの例を付録 A.1 に示す。
もう1つは、シンプルなChain-of-Thoughtプロンプティング(Wei ら、 2022 [11])として、命令を 2 段階に分けて行うプロンプトで、これを two-step のプロンプトと呼ぶ。
具体的には、入力された要因情報の文章から、株価変動の要因と考えられる部分を抽出し要約する命令と、その出力から記事を生成する命令を連続して行う。
two-step のプロンプトの例を付録 A.2 に示す。
両方のプロンプトで、zero-shot で生成された記事と、5 件の学習用事例を使った few-shot学習で生成された記事の比較、評価を行った。



5.2 評価

5.2.1 結果100 件の評価用事例について、生成された記事の評価を行った。
評価指標としては、ROUGE-1 および ROUGE-L (Lin, 2004)[5]を用いた。
ROUGE は、自然言語処理において自動要約や機械翻訳を評価するために一般的に用いられる指標で、ROUGE-1 は生成テキストと正解テキストの間の単語(1-gram)の共起を、ROUGE-L は最長共通部分列(LCS)の共起をそれぞれ評価する。
ROUGE-1，ROUGE-L について、適合率、適合率、F 値をそれぞれ算出した。
各手法によって生成された記事の ROUGE スコアを表 3に示す。
few-shot 学習で生成された記事が、zero-shotで生成された記事よりも、baseline と two-step のいずれのプロンプトにおいても、ROUGE-1 および表 3 ROUGE による評価の結果手法ROUGE-1 ROUGE-L 出力記事の適合率再現率 F 値 適合率再現率 F 値平均文字数zero-shot (baseline) 0.537 0.373 0.444 0.327 0.226 0.260 160.7zero-shot (two-step) 0.555 0.519 0.530 0.348 0.323 0.335 242.3few-shot (baseline) 0.626 0.472 0.554 0.418 0.312 0.355 200.0few-shot (two-step) 0.577 0.520 0.541 0.374 0.333 0.348 237.0表 4 人手で書かれた記事と生成された記事の例手法記事人手の記事フューチャーリンクネットワーク <9241> が動意づき、現在はストップ高カイ気配となっている。
同社はきょうの取引開始前に、人工知能（ＡＩ）×地域活性化をテーマとした新会社「地域活性ＡＩテクノロジーズ」を設立したと発表。
これが材料視されているようだ。
……(文字数: 250)zero-shot (base-line)ＦＬネット（銘柄コード：9241）の株価は、直近 3 日間で大きく変動し、1645円から 1616 円に一時下落した後、2016 円まで急伸した。
この変動の背景には、同社が 2024 年 9 月 2 日に発表した新会社「地域活性 AI テクノロジーズ株式会社」の設立がある。
……(ROUGE-1 (F 値): 0.462, ROUGE-L (F 値): 0.283, 文字数: 217)zero-shot (two-step)ＦＬネット <9241> の株価は、ここ 3 日間で大きな変動を見せた。
初日の 1645円から 1616 円へと一度下落した後、3 日目には 2016 円と急上昇を記録している。
この背景には、同社が設立を発表した新会社「地域活性 AI テクノロジーズ株式会社」があると見られる。
……(ROUGE-1 (F 値): 0.503, ROUGE-L (F 値): 0.309, 文字数: 280)few-shot (base-line)フューチャーリンクネットワーク（FLN）<9241> が急騰。
同社は 9 月 2 日、新会社「地域活性 AI テクノロジーズ株式会社」を設立し、生成 AI 技術を活用した地域活性化事業を本格始動すると発表。
……(ROUGE-1 (F 値): 0.529, ROUGE-L (F 値): 0.336, 文字数: 212)few-shotフューチャーリンクネットワーク（FL ネット）>9241> の株価が急騰している。
同社は新会社「地域活性 AI テクノロジーズ株式会社」の設立を発表し、市場の注目を集めた。
……(ROUGE-1 (F 値): 0.530, ROUGE-L (F 値): 0.335, 文字数: 296)ROUGE-L の F 値で高いスコアを達成したことが分かる。
この結果から、JFinSRでfew-shot学習を行うことで、人手で書かれた記事により近い内容の記事を生成できることが明らかになった。
5.2.2 記事の生成例人手で書かれた記事と、LLM を用いた各手法によって生成された記事の例を表 4 に示す。
zero-shotの生成例では、対象となる銘柄の名前を「FL Net」と省略しているが、few-shot の生成例では、人手で書かれた記事と同様に、正式名称の後に “¡¿” で囲まれた銘柄コードが続く形式で書かれている。
また、few-shot の生成例では、baseline と two-stepのどちらのプロンプトにおいても、株価の変動を「急騰」という用語で言い換えている点で、人手で記事を書くときと同様の操作を LLM が行っていることが分かる。



6 おわりに

本稿では、株価変動に関連する金融ニュース記事の生成タスクについて研究した。
まず、1 日の株価変動率ランキングを用いた金融記事生成のための日本語データセット(JFinSR)を構築した。
JFinSRは、株探の日別株価変動率上位 50 銘柄のランキングと株価変動記事、日本経済新聞の株価変動要因情報から構成される。
続いて、JFinSR に含まれる記事と要因情報の内容の対応関係を、要因情報の開示日からランキングへの掲載日までの経過日数で分類して検証した。
また、要因情報と同じ内容について書かれた記事が存在する事例に絞って、要因情報の内容と形式に関する分析を行った。
さらに，LLM で few-shot 学習を行うことで、要因情報から質の高い記事を自動生成することを可能にした。
生成された記事の評価では、zero-shot と JFinSR を用いた few-shot 学習を比較し、few-shot 学習の方がROUGE-1/ROUGE-L の指標において、高いスコアを達成した。
これらの分析、実験結果から、JFinSR は株価上昇・下落要因情報に基づく金融記事自動生成に十分有用なデータセットであることが示された。
今後の課題としては、要因情報としてテキスト情報だけではなく、図や表などを含む非テキスト情報も利用して記事を生成することが挙げられる。



謝辞

本論文は、一部、科研費 21H00901、電気通信普及財団 2023 年度研究調査助成、弥生株式会社共同研究の支援を受けたものである。

参考文献


[1] Qinkai Chen. Stock movement prediction with ﬁnan-cial news using contextualized embedding from BERT.http://arxiv.org/abs/2107.08721, 2021.
[2] Jiaying Gong, Bradley Paye, Gregory Kadlec, and HodaEldardiry. Predicting stock price movement using ﬁnancialnews sentiment. In Proc. 22nd EANN, pp. 503–517,2021.
[3] Ali Hassanzadeh Kalshani, Ahmad Razavi, and RezaAsadi. Stock market prediction using daily news head-lines. https://ssrn.com/abstract=3685530, 2020.
[4] Joshi Kalyani, H. N. Bharathi, and Rao Jyothi.Stock trend prediction using news sentiment analysis.http://arxiv.org/abs/1607.01958, 2016.
[5] Chin-Yew Lin. ROUGE: A package for automatic eval-uation of summaries. Text Summarization BranchesOut, pp. 74–81, 2004.
[6] Yang Liu, Qingguo Zeng, Huanrui Yang, and Adrian Car-rio. Stock price movement prediction from ﬁnancial newswith deep learning and knowledge graph embedding. InProc. 15th PKAW, pp. 102–113, 2018.
[7] Shunsuke Nishida, Yuki Zenimoto, Xiaotian Wang,Takuya Tamura, and Takehito Utsuro. Headline gener-ation for stock price ﬂuctuation articles. In Proc. 6thFinNLP, pp. 22–30, 2023.
[8] OpenAI. GPT-4o system card, 2024. https://openai.com/index/gpt-4o-system-card/.
[9] Gakuto Tsutsumi and Takehito Utsuro. Detecting causesof stock price rise and decline by machine reading com-prehension with BERT. In Proc. 4th FNP, pp. 22–35,2022.
[10] Takehito Utsuro and Shunsuke Nishida. Japanese term se-lection for stock price ﬂuctuation by large language models.In Proc. 38th PACLIC, 2024.
[11] Jason Wei, Xuezhi Wang, Dale Schuurmans, MaartenBosma, Fei Xia, Ed Chi, Quoc V Le, and Denny Zhou.Chain-of-thought prompting elicits reasoning in large lan-guage models. In Proc. 36th NIPS, p. 24824–24837,2022.




A プロンプトの例

以下は 5 節の記事生成において、実際に GPT-4oに入力されたプロンプトの例である。

A.1 base-line のプロンプト

###命令”””あなたはプロの記者です。
下記の条件と入力される情報をもとに、記事を出力してください。
”””###条件”””・記事は銘柄名、株価の変動を表す用語、簡潔に要約した変動理由からなる。
・箇条書きではなく、文章の形で出力する・本文は 300 文字程度・文体は常体”””###入力文”””銘柄名：ＦＬネット <9241>３日間の株価変動：1645, 1616, 2016変動理由となる出来事の情報：2024 年 9 月 2 日（月）株式会社フューチャーリンクネットワークFLN，AI ×地域活性化をテーマに新会社「地域活性 AI テクノロジーズ株式会社」を設立。
AI 活用のリスキリングサービスを提供開始。
”””

A.2 two-step のプロンプト

< ステップ 1>###命令”””あなたはプロの金融アナリストです。
下記の文章から、株価変動の原因となり得る内容について述べた部分を抜粋して要約してください。
”””###文章”””2024 年 9 月 2 日（月）株式会社フューチャーリンクネットワークFLN，AI ×地域活性化をテーマに新会社「地域活性 AI テクノロジーズ株式会社」を設立。
AI活用のリスキリングサービスを提供開始。
. . .”””< ステップ 2>###命令”””あなたはプロの記者です。
下記の条件と入力される情報をもとに、記事を出力してください。
”””###条件”””・記事は銘柄名、株価の変動を表す用語、簡潔に要約した変動理由からなる・箇条書きではなく、文章の形で出力する・本文は 300 文字程度・文体は常体”””###入力文”””銘柄名：ＦＬネット <9241>３日間の株価変動：1645, 1616, 2016変動理由となる出来事の情報：{< ステップ 1>で出力された要約テキスト}”””