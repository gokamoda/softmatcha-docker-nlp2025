言語モデルを用いた定量的推論機能の実現に向けて

伊東恵美

1

 小林一郎

11

お茶の水女子大学



 {g2020508,koba}@is.ocha.ac.jp   



概要

本研究は、言語モデルに実世界に対応した定量的推論（特にファジィ推論）機能を組み込むことを目的とする。
二つの物体が衝突した後の状態を言語モデルにより自然言語で推論すると同時に、推論の中に含まれる程度を表す表現に対する物理量を回帰型ニューラルネットワークを用いて学習させる。
これにより定量的な状態変化を反映したファジィ推論により帰結となる定量的な物理量を表すメンバーシップ関数を推定する。
特に、具体的な値で表せない「かなり」「少し」などの程度の表現の意味合いを学習させることを対象とし、その曖昧な表現を表すメンバーシップ関数として予測されたものの精度を測ることにより、推論の妥当性を検証する。


1 はじめに

十分な大きさを持つ言語モデルには、Chain ofThought [1]など多段の手続きによる人間の思考過程の模倣を始めとし、様々な推論能力が備わっていることが確認されている。
大規模言語モデルは大量のコーパスを学習することにより、記号としての言語を因果性を含めた自然言語文を生成するという形で操作することが可能である。
しかし実世界をつなぐ記号操作、つまり、実世界環境と対応した定量的な言語による推論は十分に検証されていない。
以上より、本研究では言語モデルに実世界における物理的推論能力を組み込むことを考え、推論のなかでも、実世界で観測された現象を曖昧な言語を用いて表現し、定量的に推論を行うファジィ推論を組み込む手法を開発する。
具体的な課題として、物理環境における因果性にまつわる常識が記述された自然言語データセット[2]を用いて提案手法を検証する。
本稿では特に、「かなり」「少し」という曖昧な程度の表現を含む文章を事前に学習させることで意味合いを理解させ、定量的な物理量に反映させることに着目する。


2 言語モデルを用いたファジィ推論

本研究では二つの物体が衝突する際の条件を与えて衝突後の様子を描写する、図 1 に示すような推論が行われる。
規則として物体が衝突する際の物理常識と考えられる自然言語文を与えた上で、事実として衝突の事象を与え、結論として衝突後の様子を描写させる。
規則： 重い物体が軽い物体に衝突すると、軽い物体が弾き飛ばされる。
事実： かなり重い立方体とかなり軽い円柱が衝突する。
結論： 円柱がかなり弾き飛ばされる。
図 1 本研究におけるファジィ推論の例図 2 に学習概要を示す。
図 2 学習概要本研究では言語モデル T5 [3]に二つの物体が衝突する際の条件を入力し、衝突後の様子の描写を出力として得る。
曖昧な言語が示す現象の物理量はファジィ推論のメンバーシップ関数を用いて表現し、その関数の学習には回帰型ニューラルネットワークを用いる。
物体の予測状態を表す曖昧な表現（例：「かなり弾き飛ばされる」等）は埋め込みベクトルに変換する。
衝突する二つの物体の質量・スピードのメンバーシップ関数と物体の予測状態を表す表現の埋め込みベクトルを入力とし、物体が飛ばされる距離のメンバーシップ関数を学習した回帰モデルを用いて予測する。
これにより、曖昧な言語表現に対して文脈に応じてメンバーシップ関数が動的に決定され、実世界の文脈に沿った定量的な物理量が生成された言語表現に対応づけられる。
メンバーシップ関数はガウス分布の平均と分散に対応する二つの値として、それぞれ物理的常識を踏まえて予め設定しておく。
分散は条件に関わらず固定で、平均の値が条件に基づいて決定される。



3 実験



3.1 データセット

本研究では物理環境における因果性にまつわる常識が記述された自然言語データセット[2]で事前学習済みの T5 をファインチューニングすることで実験を行なう。
本研究で使用したデータ[2]は、環境や物体の状態を考慮した上で、物体同士の衝突状況を言語で記述したデータセットであり、主データと補助データに分かれている。
一例を表 3 に示す。
主データは「立方体と円柱が衝突する」というような衝突する二つの物体を記述した文と衝突時の条件を与え、クラウドワーカーに衝突後の様子を描写してもらった 5 つの文を一つのセットとしている。
実験では衝突の条件をもとに、二つの物体の質量・スピードを示すメンバーシップ関数と、衝突の際に物体が飛ぶ距離を示すメンバーシップ関数をそれぞれガウス分布の平均・分散で表現した。
質量・スピードについて、一つ目の物体の質量、二つ目の物体の質量、一つ目の物体のスピード、二つ目の物体の質量の順で記述している。
また、程度の表現を含む推論を行うために、主データの環境・物体の状態に「かなり」「とても」「やや」「少し」という表現を追加した。
加えて、物体の形状・質量・速度・状態などを重複なくすべての表現の組み合わせに基づき調整し、条件に基づき物体の質量とスピード・衝突後に飛ばされる距離のメンバーシップ関数を与えた 618 件のデータ（これを本稿では「プレーンデータ」と呼ぶ）を構築した。
全ての条件を網羅しているため「かなり」「とても」「やや」「少し」という程度の表現が他のデータより多く含まれている。
評価用データと同様に推論の評価に使用するが、クラウドワーカーによる回答は付随していないため、メンバーシップ関数のみの評価を行う。
表 1 主データ件数学習用検証用評価用プレーン全体 1244 230 230 618程度の表現含む 204 60 60 528補助データは環境・物体の属性の特定の条件下における衝突時の影響に関する質問とクラウドワーカーによる回答例がまとめられている。
上述の理由で、物体の材質に対し言及したデータも主データ同様に除き、その上で床の状態や物体の質量・スピードに対し「かなり」「とても」「やや」「少し」という程度を表す表現を追加した。
一例を表 4 に示す。
補助データはファジィ推論における規則に相当している。
常識的な知識の強化を目的として、各条件に対し、飛ばされる距離にどのような影響を及ぼすかという推論過程のデータを追加した。
例えば「床がツルツルしているので飛ばされる距離が伸びる」という推論過程を学習するために、一段階目として「床がツルツルしているので滑りやすい」二段階目として「滑りやすいので飛ばされる距離が伸びる」という推論がなされるが、現在の補助データだと一段階目の推論部分しか含んでいない。
そこで二段階目の推論部分を補助データに追加した。
データセットについての詳細は付録 A に示す。
これにより補助データにおいて二段階の推論が行われるため、一段階目、二段階目の補助データで学習済み T5 モデルを二回ファインチューニングする。
表 2 補助データ件数学習用検証用評価用一段階目 885 105 105二段階目 115 25 25さらに全体の学習の流れとして、補助データで学習を行なった後、主データで学習させる。
先述の通り補助データはファジィ推論における規則に相当し、先に補助データを学習させることで環境・物体の状態から推論によって得られる帰結を用いることが可能となり、その規則を通じて得られた情報と観察された物体の情報を示す主データの前件部を入力情報として、ファジィ推論を行わせる。



3.2 実験設定

実験には PyTorch1）を用い、ウェブ上で公開されている日本語のテキストデータで事前学習済みの T52）を用いる。
T5 のファインチューニングの設定とし1） https://pytorch.org/2） https://huggingface.co/sonoisa/t5-base-japanese表 3 主データ例ベースとする文：立方体と円柱が衝突する。
環境・物体の状態クラウドワーカーによる回答床がツルツルしている。
・円柱が立方体に勢いよく衝突して、立方体が遠くに弾き飛ばされる。
立方体の質量が小さい。
・立方体と円柱が衝突して、立方体が遠くにとばされる。
円柱の質量が大きい。
・円柱は勢いよく立方体に衝突して、立方体は勢いよく弾き飛ばされる。
立方体のスピードが遅い。
・円柱が立方体にぶつかって立方体が倒れる。
円柱のスピードが速い。
・円柱は勢いよく立方体に衝突して、立方体は遠くに弾き飛ばされる。
物体の質量とスピード： (20, 4, 30, 4, 10, 4, 14, 4)衝突後に飛ばされる距離： (12, 1)表 4 補助データ例条件回答例床がツルツルしている。
滑りやすい。
摩擦が少ない。
床がとてもツルツルしている。
かなり滑りやすい。
摩擦がとても少ない。
質量が大きい。
衝撃が大きい。
動きにくい。
質量がやや大きい。
衝撃がやや大きい。
やや動きにくい。
物体の形が円柱。
衝突時に停止しやすい。
物体の形が球。
少しの衝撃でも転がりやすい。
て、学習率は 1 × 10−4、バッチサイズは 32、エポック数は 200、最適化手法は AdamW [4]を用いた。
また、始めの 10 エポックで、学習率を 0 から設定した学習率まで線形に学習率を増加させる war m up を用いた。
学習時の損失関数には交差エントロピーを使用した。
検証用データに対する BLEU 値が最も高いモデルのパラメータを用いて、評価用データ、プレーンデータで評価した。
副詞や形容詞で表される程度の表現を追加した補助データで学習させた後、主データで学習させる。
主データで学習させる際に学習させて出てきた文を 768 次元の埋め込みベクトルに変換3）する。
埋め込みベクトルは質量・スピードを表すメンバーシップ関数と共に、飛ばされる距離を表すメンバーシップ関数を推定する回帰型ニューラルネットワークに入力される。
主データで学習を行う際、程度の表現を含まないデータで学習を行い、程度の表現を含むデータで正しく推論を行えるかを確かめる。
補助データに程度の表現が含まれること、衝突する二つの物体の質量・スピードのメンバーシップ関数がニューラルネットワークに入力されることから推論が正しく行われることを期待する。
補助データを学習させることで程度の表現の学習に差が出ることを確かめるため、補助データで事前学習を行わない実験 1 と、補助データで事前学習を行う実験 2 を行う。
回帰ニューラルネットワークの構成は、入力層の3） https://huggingface.co/sonoisa/sentence-t5-base-ja-mean-tokensニューロン数が 776 個、一つ目の中間層のニューロン数が 64 個、二つ目の中間層のニューロン数が 32個、出力層のニューロン数が 2 個となっている。
中間層の活性化関数には ReLU 関数を、出力層の活性化関数には恒等関数を用いている。
また、最適化アルゴリズムには RMSProp オプティマイザを使用し、各エポックごとに 50 回回帰させる。



3.3 評価指標

生成文の自動評価指標には言語生成タスクで用いられている、BLEU[5]，ROUGE[6]を使用する．BLEU は 4-gram の一致を用い、学習時の検証データの評価にも使用した。
ROUGE は ROUGE-2，ROUGE-L の 2 つを使用し、いずれの指標も値が大きい方が高精度であることを意味する。
評価時には、クラウドワーカーによる回答 5 文それぞれに対して評価を実施し、平均の値を評価結果とする。
また、各評価指標は 0-100 にスケールして記載する。
ガウス分布により表現したメンバーシップ関数の一致に関する評価指標にはカルバック・ライブラー情報量を用いる。
また、程度の表現を含む衝突の条件に対応するメンバーシップ関数については程度の表現を除いた条件に対応するメンバーシップ関数と比較することで精度を測る。
図 3 に例を示す。
「灰色の円柱と球が衝突する。
灰色の円柱のスピードがかなり速い。
球のスピードがかなり遅い。
」
という
条件のメンバーシップ関数の推論値の平均14.2 に対して、推論できるはずの「かなり」を除い表 5 実験結果生成文メンバーシップ関数エポック数データセット BLEU ↑ ROUGE-2 ↑ ROUGE-L ↑ KL 情報量和↓ 程度の表現正解率↓実験 1 114 test 93.7 59.8 70.2 370.7 0.80 (48/60)plain - - - 2913.0 0.68 (357/528)実験 2 103 test 94.0 60.1 70.4 174.0 0.90 (54/60)plain - - - 791.0 0.92 (486/528)表 6 実験 2 における生成結果ベースとする文: 立方体が円柱と衝突する。
床立方体円柱生成文質量・スピード正解値推測値1 3,8 6,10 円柱は勢いよく立方体に衝突して、立方体は遠くに弾き飛ばされる。
[25,4,35,4,9,4,15,4][16, 1][14.7, 1.0]- 3,8 6,10 円柱は勢いよく立方体に衝突して、立方体は弾き飛ばされる。
[25,4,35,4,7,4,13,4][14, 1][13.1, 1.0]- 3,9 6,9 立方体と円柱が衝突して、立方体は弾き飛ばされる。
[25,4,35,4,10,4,10,4][10, 1][10.8, 0.9]- 4,9 5,9 立方体と円柱が衝突して、立方体は弾き飛ばされる。
[28,4,32,4,10,4,10,4][8, 1][7.8, 1.0]- 2 7 立方体が円柱と衝突して、立方体は弾き飛ばされる。
[20,4,40,4,10,4,10,4][14, 1][12.2, 1.0]〈床・円柱・球体のパターン〉床の条件 ：1. 床がツルツルしている。
物体の質量の条件 ：2. 質量がかなり小さい。
3. 質量が小さい。
4. 質量がやや小さい。
5. 質量がやや大きい。
6. 質量が大きい。
7. 質量がかなり大きい。
物体の速さの条件 ：8. スピードが遅い。
9. スピードが等しい。
10. スピードが速い。
図 3 比較による程度の表現の評価例た条件のメンバーシップ関数の正解値の平均 12.0と比較する。
程度の表現が含まれていない場合の数値は推論可能であることを踏まえ、二つの正解値を比較すると、この条件では「かなり」という表現が追加されることで飛ばされる距離が伸びることが分かる。
よって、今回の例では程度の表現がついていないメンバーシップ関数の正解値 12.0 より大きければ正解とする。

3.4 実験結果

実験結果を表 5 に示す。
生成文の評価は BLEU，ROUGE-2，ROUGE-L 全ての指標において、実験 2の補助データで事前学習を行ってから主データで学習を行なったものの結果の方が少し高くなった。
メンバーシップ関数の評価も同様に、実験 2 の結果が実験 1 の結果よりも良かった。
条件を網羅しており程度の表現が多く含まれるプレーンデータにおいて、実験 1 との差が強く現れている。
実験 2 における生成結果の一部を表 6 に示す。
推測値は小数点以下第二位で四捨五入している。
生成文について見ていく。
1,2 行目を比較すると「床がツルツルしている。
」
という
条件がついている 1 行目では「遠くに」弾き飛ばされ、2,3 行目を比較すると、スピードに差があり衝突の勢いが強い 2 行目では「勢いよく」衝突し、パターンに応じた学習ができている。
程度の表現が条件に加えられた 4,5 行目においては、「少し」が条件に加わり衝突の勢いが弱まった 4 行目も「かなり」が条件に加わり衝突の勢いが増した 5 行目も程度の表現を含まない 3 行目とほぼ同じ生成文が出力されている。
これは補助データの情報だけでは生成文に程度の表現を反映させることができなかったと考えられる。
実験 2 においてメンバーシップ関数の精度が上昇したことから、補助データを学習させることで、入力として与えている埋め込みベクトルと二つの物体の質量・スピードのメンバーシップ関数の意味を汲みとれるようになったものと考えられる。


4 まとめ

本研究では物体の衝突という物理現象に焦点を当て、言語モデル T5 をファインチューニングすることで自然言語を用いて衝突後の状態を推論させた。
また、ニューラルネットワークを学習させてメンバーシップ関数を意に沿った形で導き出させることで、言語モデルを用いてファジィ推論を実現した。
事前知識を学習させることで、曖昧な表現に対応する定量的な物理量をより正確に表現させることに成功した。
今回の実験においては限定された物理環境の下での実験であったことから、今後は、円柱や立方体に限らず任意の物体に対しメンバーシップ関数を動的に推測させ、より観測環境に適した汎用性の高いファジィ推論を行いたい。
また、提案手法が大規模言語モデルによってどの程度実現可能であるかについて評価を行い、今後の研究の方向性を検討するつもりである。



謝辞

本研究は JSPS 科研費 23H03453J の助成を受けたものです。

参考文献


[1] Jason Wei, Xuezhi Wang, Dale Schuurmans, MaartenBosma, Brian Ichter, Fei Xia, Ed Chi, Quoc Le, and DennyZhou. Chain-of-thought prompting elicits reasoning in largelanguage models. 2022. cite arxiv:2201.11903.
[2] 田屋侑希, 小林一郎. 実世界における物理制約を踏まえた言語による推論. 人工知能学会全国大会論文集第 37 回 (2023), pp. 1E4GS603–1E4GS603. 一般社団法人 人工知能学会, 2023.
[3] Colin Raﬀel, Noam Shazeer, Adam Roberts, Katherine Lee,Sharan Narang, Michael Matena, Yanqi Zhou, Wei Li, andPeter J Liu. Exploring the limits of transfer learning witha uniﬁed text-to-text transformer. Journal of machinelearning research, Vol. 21, No. 140, pp. 1–67, 2020.
[4] Ilya Loshchilov and Frank Hutter. Decoupled weight decayregularization. arXiv preprint arXiv:1711.05101, 2017.
[5] Kishore Papineni, Salim Roukos, Todd Ward, and Wei-JingZhu. Bleu: a method for automatic evaluation of machinetranslation. In Proceedings of the 40th annual meetingof the Association for Computational Linguistics, pp.311–318, 2002.
[6] Chin-Yew Lin. Rouge: A package for automatic evaluationof summaries. In Text summarization branches out,pp. 74–81, 2004.




A データセット



A.1 衝突の条件

先行研究[2]で取り扱っている衝突の条件は以下の条件の通りである。
• 環境– 床がツルツルしている。
– 床がザラザラしている。
• 物体の状態（質量）– 物体 A と物体 B の質量が等しい。
– 物体 A の質量が大きい。
物体 B の質量が小さい。
– 物体 A の質量が小さい。
物体 B の質量が大きい。
• 物体の状態（スピード）– 物体 A と物体 B のスピードが等しい。
– 物体 A のスピードが速い。
物体 B のスピードが遅い。
– 物体 A のスピードが速い。
物体 B のスピードが遅い。
環境についての条件は記載しない場合を含め 3 パターン、物体の状態についての条件は少なくともどちらか一方を記載するため 15 パターン、組み合わせによって合計 45 パターンとなる。
本研究において床の状態・物体の質量・物体のスピードの 3 つの条件のうち最大 1 つに「かなり」「とても」「やや」「少し」という程度の表現を追加した。
それに伴い衝突時の描写に相当する表現を追加し、メンバーシップ関数にも反映させた。
質量が大きくスピードが遅い物体と質量が小さくスピードが速い物体が衝突する場合、先行研究のクラウドワーカーによる回答も分かれており、どちらが飛ばされるか分かりにくい条件に対しては程度の表現を追加しない。
また先行研究において、衝突する物体の材質が金属製・ゴム製と与えられているデータがあるが、推論を簡単にするために本研究では除いた。


A.2 メンバーシップ関数の決定

質量のメンバーシップ関数に対しては、下に示すとおり設定した。
条件で質量について言及されていない場合は等しいものとして扱う。
• 質量が等しいならメンバーシップ関数は(30,4)最小値は 25、最大値は 35• 質量が小さいならメンバーシップ関数は(25,4)最小値は 20、最大値は 30• 質量が大きいならメンバーシップ関数は(35,4)最小値は 30、最大値は 40スピードのメンバーシップ関数の決定においては床の条件も関わるため、下に示したスピードが速くなる条件を数え、合計値が大きくなるほどスピードが大きくなるようにメンバーシップ関数を決定する。
条件でスピードについて言及されていない場合は質量と同様に等しいものとして扱う。
• スピードが速い場合、メンバーシップ関数は(13,4)最小値は 10、最大値は 16• スピードが遅い場合、メンバーシップ関数は(7,4)最小値は 4、最大値は 10• スピードが等しい場合、メンバーシップ関数は(10,4)最小値は 7、最大値は 13• 床がツルツルしている場合、平均に+2• 床がザラザラしている場合、平均に-2物体が飛ばされる距離のメンバーシップ関数は以下のように決定する。
弾き飛ばされる距離が伸びる条件を数え、合計値が大きくなるほど飛ばされる距離が伸びるようにメンバーシップ関数を設定する。
使用するデータセット[2]に含まれる回答を参考に、衝突によって弾き飛ばされる距離が伸びる条件を以下のように数える。
また、飛ばされる側の決定について、質量が小さいものが飛ばされるとし、質量の条件が指定されていない場合はスピードの遅いものが飛ばされるとする。
どちらの条件も指定されていない場合は、球体である方が飛ばされるとする。
• 飛ばされる側の物体の質量が小さい +2• 飛ばされる側の物体のスピードが速い -2• 飛ばされる側の物体のスピードが遅い +2• 床がツルツルしている +1• 床がザラザラしている -1• 飛ばされる側の物体が球である +1数えた合計値を 2 倍して 6 を加えたものを平均として、メンバーシップ関数を設定する。
例えば、質量が大きい円柱と質量が小さい立方体がツルツルした床の上で衝突する場合、合計値は 3 なので、メンバーシップ関数は(12,1)、最小値は 10、最大値は 14となる。